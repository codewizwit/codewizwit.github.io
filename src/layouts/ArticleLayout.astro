---
import BaseLayout from './BaseLayout.astro';
import Header from '../components/global/Header.astro';
import Footer from '../components/global/Footer.astro';

interface Props {
  title: string;
  description: string;
  type: string;
  number: number;
  publishDate: Date;
  tags: string[];
  canonicalUrl?: string;
}

const { title, description, type, number, publishDate, tags, canonicalUrl } = Astro.props;

const typeLabels: Record<string, string> = {
  'dispatch': 'Dispatch',
  'field-note': 'Field Note',
  'side-piece': 'Side Piece',
  'case-study': 'Case Study',
  'think-piece': 'Think Piece',
};

const typeLabel = typeLabels[type] || type;
const formattedDate = publishDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonicalUrl}
  ogType="article"
  publishDate={publishDate}
>
  <Header />
  <main id="main-content">
    <article class="article">
      <!-- Article Header -->
      <header class="article-header section-cream section">
        <div class="container container-narrow">
          <div class="article-meta">
            <span class="article-type-badge">{typeLabel} â„–{number}</span>
            <time datetime={publishDate.toISOString()} class="article-date">
              {formattedDate}
            </time>
          </div>
          <h1 class="article-title">{title}</h1>
          <p class="article-desc">{description}</p>
        </div>
      </header>

      <!-- Article Body -->
      <div class="article-body section-cream">
        <div class="container container-narrow">
          <div class="prose">
            <slot />
          </div>
        </div>
      </div>

      <!-- Article Footer / Signature -->
      <footer class="article-footer section-cream section-sm">
        <div class="container container-narrow">
          <div class="article-signature">
            <img
              src="/images/codewizwit-logo.jpg"
              alt=""
              class="signature-mark"
              width="48"
              height="33"
              loading="lazy"
            />
            <div class="signature-text">
              <p class="signature-name">Alexandra Kelstrom</p>
              <p class="signature-tagline">No Human Left Behind.</p>
            </div>
          </div>

          {tags.length > 0 && (
            <div class="article-tags">
              {tags.map((tag) => (
                <span class="article-tag">#{tag}</span>
              ))}
            </div>
          )}

          <nav class="article-nav" aria-label="Article navigation">
            <a href="/writing" class="link">All writing</a>
          </nav>
        </div>
      </footer>
    </article>
  </main>
  <Footer />
</BaseLayout>

<style>
  /* ---- Article Header ---- */

  .article-meta {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-sm);
  }

  .article-type-badge {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--color-gold-dark);
  }

  .article-date {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
  }

  .article-title {
    font-family: var(--font-heading);
    font-size: var(--text-4xl);
    line-height: 1.1;
    letter-spacing: -0.02em;
    margin-bottom: var(--space-sm);
  }

  .article-desc {
    font-size: var(--text-lg);
    line-height: 1.5;
    color: var(--color-text-secondary);
    max-width: 38rem;
  }

  /* ---- Article Body ---- */

  .article-body {
    padding-bottom: var(--space-2xl);
  }

  /* ---- Signature ---- */

  .article-signature {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md) 0;
    border-top: 1px solid var(--color-gray-border);
    margin-bottom: var(--space-md);
  }

  .signature-mark {
    width: 48px;
    height: auto;
    transform: rotate(-12deg);
    opacity: 0.85;
  }

  .signature-name {
    font-weight: 600;
    font-size: var(--text-base);
  }

  .signature-tagline {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    font-style: italic;
  }

  /* ---- Tags ---- */

  .article-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2xs);
    margin-bottom: var(--space-md);
  }

  .article-tag {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    font-family: var(--font-code);
  }

  /* ---- Nav ---- */

  .article-nav {
    padding-top: var(--space-md);
    border-top: 1px solid var(--color-gray-border);
  }
</style>
